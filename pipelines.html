---
layout: default
---

<div id="home">
    <h1>
        {% for header in site.headers %}
        <a class="header" href="{{ header.url }}">{{ header.name }}</a>
        {% endfor %}
    </h1>
    <p/>

    <h2>pgagroal pipelines</h2>

    pgagroal supports 3 different pipelines

    <ul>
      <li>Performance</li>
      <li>Session</li>
      <li>Transaction</li>
    </ul>

    The pipeline is defined in pgagroal.conf configuration file under the setting of "pipeline".

    <p/>
    pgagroal will choose either the performance or the session pipeline
    based on the configuration settings by default.

    <h3>Performance</h3>
    
    The performance pipeline is fastest pipeline as it is a minimal implementation
    of the pipeline architecture.

    <p/>
    
    However, it doesn't support Transport Layer Security (TLS), failover support and
    the "disconnect_client" setting.

    <p/>
    
    A "DISCARD ALL" query is run after each client session.

    <p/>
    
    Select the performance pipeline by

    <pre>
pipeline = performance
    </pre>

    <h3>Session</h3>

    The session pipeline supports all features of pgagroal.

    <p/>
    
    A "DISCARD ALL" query is run after each client session.

    <p/>
    
    Select the session pipeline by

    <pre>
pipeline = session
    </pre>

    <h3>Transaction</h3>

    The transaction pipeline will release the connection back to the pool after each
    transaction completes. This feature will support many more clients than there are
    database connections.

    <p/>

    However, there are some session based features of PostgreSQL that can't be supported in this
    pipeline.

    <ul>
      <li>SET / RESET</li>
      <li>LISTEN / NOTIFY</li>
      <li>WITH HOLD CURSOR</li>
      <li>PREPARE / DEALLOCATE</li>
    </ul>

    It is assumed that all clients using the same user name and database pair share the same
    startup parameters towards PostgreSQL.

    <p/>

    <b>SET / RESET</b><br/>

    The "SET" functionality is a session based feature.

    <p/>

    <b>LISTEN / NOTIFY</b><br/>

    The "LISTEN" functionality is a session based feature.

    <p/>

    <b>WITH HOLD CURSOR</b><br/>

    The "WITH HOLD CURSOR" functionality is a session based feature.

    <p/>

    <b>PREPARE / DEALLOCATE</b><br/>

    While using "PREPARE" and "EXECUTE" can be used the prepared statements are tied to the
    connection they were created in which means that clients can't be sure that they created
    the prepared statement on the connection unless it is issued within the same transaction
    where it is used.

    <p/>

    Note, that pgagroal does not issue any "DEALLOCATE ALL" nor "DISCARD ALL" statements
    when using the transaction pipeline.

    <p/>

    <b>Performance considerations</b><br/>

    Clients may need to wait for a connection between transactions leading to a higher
    latency.

    <p/>

    <b>Important</b><br/>

    Make sure that the "blocking_timeout" settings to set to 0. Otherwise active clients
    may timeout during their workload. Likewise it is best to disable idle connection timeout by
    setting "idle_timeout" to 0.

    <p/>

    It is highly recommended that you prefill all connections for each user.

    <p/>

    The transaction pipeline doesn't support the "disconnect_client" setting.
    
    <p/>
    
    Select the transaction pipeline by

    <pre>
pipeline = transaction
    </pre>

</div>
